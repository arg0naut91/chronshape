################################################
#
# Test script for chronshape - partition_ranges
#
# Last updated on 07/04/2019
#
################################################
context("partition_ranges")

test_that("partition_ranges is functional when partitioning by year", {
  
  df <- data.frame(group = c("a", "a", "b", "b", "c"),
                   start = c("2017-05-01", "2019-04-03", "2011-03-03", "2014-05-07", "2017-02-01"),
                   end = c("2018-09-01", "2020-04-03", "2012-05-03", "2016-04-02", "2017-04-05")
  ) 
  
  output <-
    structure(
      list(
        group = structure(
          c(1L, 1L, 1L, 1L, 2L, 2L, 2L,
            2L, 2L, 3L),
          .Label = c("a", "b", "c"),
          class = "factor"
        ),
        start = structure(
          c(
            17287,
            17532,
            17989,
            18262,
            15036,
            15340,
            16197,
            16436,
            16801,
            17198
          ),
          class = "Date"
        ),
        end = structure(
          c(
            17531,
            17775,
            18261,
            18355,
            15339,
            15463,
            16435,
            16800,
            16893,
            17261
          ),
          class = "Date"
        )
      ),
      class = "data.frame",
      row.names = c(NA,-10L)
    )
  
  output_foo <- partition_ranges(df, "start", "end")

  expect_equal(output, output_foo)
  
}

)

test_that("partition_ranges is functional when partitioning by month", {
  
  df <- data.frame(group = c("a", "a", "b", "b", "c"),
                   start = c("2017-05-01", "2019-04-03", "2011-03-03", "2014-05-07", "2017-02-01"),
                   end = c("2018-09-01", "2020-04-03", "2012-05-03", "2016-04-02", "2017-04-05")
  ) 
  
  output <-
    structure(
      list(
        start = structure(
          c(
            17287,
            17318,
            17348,
            17379,
            17410,
            17440,
            17471,
            17501,
            17532,
            17563,
            17591,
            17622,
            17652,
            17683,
            17713,
            17744,
            17775,
            17989,
            18019,
            18050,
            18080,
            18111,
            18142,
            18172,
            18203,
            18233,
            18264,
            18295,
            18324,
            18355,
            15036,
            15067,
            15097,
            15128,
            15158,
            15189,
            15220,
            15250,
            15281,
            15311,
            15342,
            15373,
            15402,
            15433,
            15463,
            16197,
            16228,
            16258,
            16289,
            16320,
            16350,
            16381,
            16411,
            16442,
            16473,
            16501,
            16532,
            16562,
            16593,
            16623,
            16654,
            16685,
            16715,
            16746,
            16776,
            16807,
            16838,
            16867,
            17198,
            17226,
            17257
          ),
          class = "Date"
        ),
        end = structure(
          c(
            17317,
            17347,
            17378,
            17409,
            17439,
            17470,
            17500,
            17531,
            17562,
            17590,
            17621,
            17651,
            17682,
            17712,
            17743,
            17774,
            17775,
            18018,
            18049,
            18079,
            18110,
            18141,
            18171,
            18202,
            18232,
            18263,
            18294,
            18323,
            18354,
            18355,
            15066,
            15096,
            15127,
            15157,
            15188,
            15219,
            15249,
            15280,
            15310,
            15341,
            15372,
            15401,
            15432,
            15462,
            15463,
            16227,
            16257,
            16288,
            16319,
            16349,
            16380,
            16410,
            16441,
            16472,
            16500,
            16531,
            16561,
            16592,
            16622,
            16653,
            16684,
            16714,
            16745,
            16775,
            16806,
            16837,
            16866,
            16893,
            17225,
            17256,
            17261
          ),
          class = "Date"
        )
      ),
      row.names = c(NA,-71L),
      class = "data.frame"
    )
  
  output_foo <- partition_ranges(df, "start", "end", partition_by = "month")
  
  expect_equal(output, output_foo)
  
}

)